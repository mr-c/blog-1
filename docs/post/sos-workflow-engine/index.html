<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  lang="en-us">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Droid+Sans:400,700" rel="stylesheet">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>
    
<title>SoS: a cure to pipelineitis | vatlab</title>

<meta property='og:title' content='SoS: a cure to pipelineitis - vatlab'>
<meta property='og:description' content='Because of the needs to use libraries and tools in different languages and to execute them on different systems such as computer clusters, bioinformaticians write a lot of scripts in different languages and face many challenges in developing, running, managing, sharing, and reproducing bioinformatic data analyses. Notably,
 Management of scripts: With increasing number of scripts, some in multiple versions, some shared among projects, some written for and executed on remote systems, it can be difficult to share data analyses with others, and reproduce prior data analyses at a later time.'>
<meta property='og:url' content='https://vatlab.github.io/blog/post/sos-workflow-engine/'>
<meta property='og:site_name' content='vatlab'>
<meta property='og:type' content='article'><meta property='og:image' content='https://www.gravatar.com/avatar/969c44b6bc34a74a2f1d1dc59ddaa98f?s=256'><meta property='article:section' content='Post'><meta property='article:tag' content='SoS'><meta property='article:tag' content='Workflow'><meta property='article:published_time' content='2017-12-15T00:00:00Z'/><meta property='article:modified_time' content='2017-12-15T00:00:00Z'/><meta name='twitter:card' content='summary'><meta name='twitter:site' content='@ScriptOfScripts'><meta name='twitter:creator' content='@ScriptOfScripts'>
<link rel="stylesheet" href="https://vatlab.github.io/blog//css/style.css"/><link rel='stylesheet' href='https://vatlab.github.io/blog/css/custom.css'></head>
<body>

<section class="section">
  <div class="container">
    <nav class="nav">
      <div class="nav-left">
        <a class="nav-item" href="https://vatlab.github.io/blog/"><h1 class="title is-4">vatlab
			   </h1></a>
      </div>
      <div class="nav-right">
        <nav class="nav-item level is-mobile"><a class="level-item" href='mailto:bpeng@mdanderson.org' target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
    <polyline points="22,6 12,13 2,6"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" href='https://github.com/vatlab' target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" href='https://twitter.com/ScriptOfScripts' target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/>
    
  </svg></i>
            </span>
          </a></nav>
      </div>
    </nav>
  </div>
</section>

<section class="section">
  <div class="container">
    <div class="subtitle is-6 is-pulled-right">
      
      
<a class="subtitle is-6" href="https://vatlab.github.io/blog/tags/sos">#SoS</a>



  
  | <a class="subtitle is-6" href="https://vatlab.github.io/blog/tags/workflow">#Workflow</a>
  

      
    </div>
    <h2 class="subtitle is-6">December 15, 2017</h2>
    <h1 class="title">SoS: a cure to pipelineitis</h1>
      
    <div class="content">
      

<p>Because of the needs to use libraries and tools in different languages and to execute them on
different systems such as computer clusters, bioinformaticians write a lot of scripts in different languages
and face many challenges in developing, running, managing, sharing, and reproducing bioinformatic
data analyses. Notably,</p>

<ol>
<li><strong>Management of scripts</strong>: With increasing number of scripts, some in multiple versions, some shared
among projects, some written for and executed on remote systems, it can be difficult to share data
analyses with others, and reproduce prior data analyses at a later time.</li>
<li><strong>Analyze large datasets</strong>: It is tedious and error-prone to write scripts to analyze larger and larger
amount of data as more and more work is needed for the &ldquo;execution&rdquo; part of the analysis. Additional
work includes but not limited to refactoring scripts for batch execution, creation and submission
of jobs, monitoring and fault recovery, and synchronization of data and results across system.</li>
</ol>

<h2 id="why-workflow-systems-are-not-suitable-for-daily-computational-research">Why workflow systems are not suitable for daily computational research</h2>

<p>Scientific pipeline systems are supposed to alleviate these problems by streamlining the creation
and execution of data analysis workflows. However, after surveying all
<a href="https://github.com/pditommaso/awesome-pipeline" target="_blank">100+ workflow systems</a> and trying
more than 10 of them, I realized that <strong>the overhead of applying a workflow system in daily data
analysis is too high to help productivity</strong>.
As a matter of fact, as pointed out by <a href="https://www.nature.com/articles/nbt.2740" target="_blank">Loman and Watson, 2013, Nat Biotechnol</a>,
using a workflow system for analyses that will be run only once, or not meant to be shared with or repeated
by others can decrease creativity and productivity.</p>

<blockquote>
<h4 id="pipelineitis-is-a-nasty-disease">Pipelineitis is a nasty disease</h4>

<p>A pipeline is a series of steps, or software tools, run in sequence according to a predefined plan.
Pipelines are great for running exactly the same set of steps in a repetitive fashion, and for
sharing protocols with others, but <strong>they force you into a rigid way of thinking and can decrease creativity</strong>.</p>

<p>Warning: <strong>donâ€™t pipeline too early</strong>. Get a method working before you turn it into a pipeline. And
even then, does it need to be a pipeline? Have you saved time? Is your pipeline really of use to
others? If those steps are only ever going to be run by you, then a simple script will suffice and
<strong>any attempts at pipelining will simply waste time</strong>. Similarly, if those steps will only ever be run
once, just run them once, document the fact you did so and move on.</p>
</blockquote>

<p>In another word, workflow systems are designed for repeated execution of mature workflows for
which a good deal of work is invested to help the users of workflows. They are not designed for daily
computational research where scripts are written for particular projects and are almost disposable.</p>

<h2 id="pipelineitis-is-treatable">Pipelineitis is treatable</h2>

<p>Pipelineitis is a nasty disease but admitting the facts does not save us from all the aforementioned problems
we have in daily data analysis. Looking over and over at the key obstacles that prevent the application of
workflow systems in daily computational research, we realized that <strong>narrowing the gap between environments
for interactive data analysis and workflow systems for batch data crunching would cure pipelineitis and
allow the use of workflow systems in daily computational research</strong>. With this idea in mind,
we developed <a href="https://vatlab.github.io/sos-docs/" target="_blank">SoS (Script of Scripts)</a>,
which is a workflow engine with a multi-language notebook frontend.
The following table summarizes the major features of SoS and how they help alleviate the symptoms
of pipelineitis:</p>

<div class="table table-hover">
<div></div>

<table>
<thead>
<tr>
<th>Symptom</th>
<th>Cause</th>
<th>Treatment</th>
</tr>
</thead>

<tbody>
<tr>
<td><strong>Lower productivity</strong></td>
<td>Re-create data analysis using another language or environment</td>
<td><ul><li>A <a href="https://vatlab.github.io/blog/post/sos-notebook/">single environment</a> for both interactive data analysis and batch data processing</li><li><a href="https://vatlab.github.io/blog/post/power-of-sos-plus-sos-notebook/">Easy transition</a> from interactive scripts to workflows</li></ul></td>
</tr>

<tr>
<td><strong>Steep learnin curve</strong></td>
<td>Workflow language difficult to learn and use, making it difficult to adopt</td>
<td><ul><li>Workflow as &ldquo;annotations&rdquo; to Python scripts</li><li>Trivial to get started, grow as needed</li></ul></td>
</tr>

<tr>
<td><strong>Difficult to read and share</strong></td>
<td>Data analysis logics (core steps)<ul><li>buried in execution logics</li><li>or written in foreign workflow language</li><li>or hidden behind workflow GUI</li></ul></td>
<td><ul><li>Almost verbatim inclusion of scripts</li><li>Simple workflow directives</li><li>Single multi-language notebook with annotated workflow</li></ul></td>
</tr>

<tr>
<td><strong>Difficult to reproduce</strong></td>
<td>Data analysis scattered in multiple scripts for multiple systems</td>
<td><ul><li>Ability to execute entire or parts of workflows remotely</li><li>Keep local and remote tasks in one notebook</li></ul></td>
</tr>
</tbody>
</table>

<p></div></p>

<h2 id="an-ide-for-both-interactive-data-analysis-and-workflow-development">An IDE for both interactive data analysis and workflow development</h2>

<p>A complex workflow inevitably involves scripts in multiple languages. Existing workflow systems generally
do not provide an interactive environment for the development of these scripts. Even for workflow systems
that provide nice GUIs, the graphical interfaces are used to construct workflows from mature scripts, not
for the development of workflow steps. Consequently, users are required to develop workflow steps in
other environments before wrapping them to a workflow system.</p>

<p><strong>SoS Notebook is a multi-language IDE for the SoS workflow engine</strong> that provides an interactive
environment for all stages of workflow development. As demonstrated in blog
posts <a href="https://vatlab.github.io/blog/post/sos-notebook/" target="_blank">SoS Notebook: One Notebook, Multiple Kernels</a> and
<a href="https://vatlab.github.io/blog/post/power-of-sos-plus-sos-notebook/" target="_blank">Combined power of SoS and SoS Notebook</a>,
SoS Notebook allows you to:</p>

<ul>
<li><p>Develop scripts in different languages using multiple kernels,
with added features such as string interpolation
(magic <a href="https://vatlab.github.io/sos-docs/doc/documentation/SoS_Magics.html#magic-expand" target="_blank">%expand</a>)
and line-by-line execution.</p></li>

<li><p>Convert scripts to SoS &ldquo;actions&rdquo; to be executed as (scratch) workflow steps. The &ldquo;actions&rdquo;
are Python functions and can be debugged in the SoS kernel</p></li>

<li><p>&ldquo;Chain&rdquo; the scratch workflow steps into SoS workflows by adding <code>input</code>, <code>output</code>, <code>depends</code>
statements and section headers.</p></li>
</ul>

<p>The SoS environment makes it easy to convert scripts developed in interactive
data analysis to a workflow which removes the biggest obstacle in the utilization
of workflows in daily computational researach.</p>

<h2 id="workflow-system-that-can-be-comprehended-in-minutes">Workflow system that can be comprehended in minutes</h2>

<p>SoS is extended from Python 3.6 so <strong>a SoS script is essentially a Python script with
additional workflow specifications</strong>. With Python being <a href="https://coderdojo.com/news/2015/03/20/top-5-programming-languages-for-beginners/" target="_blank">one of the easiest scripting
language to learn</a>
and <a href="https://www.tiobe.com/tiobe-index/" target="_blank">one of the most widely used scripting languages</a>,
SoS has a very smooth learning curve. As a matter of fact, SoS adds very few additional syntaxes
to Python and the follow table summarizes them all:</p>

<div class="table table-hover">
<div></div>

<table>
<thead>
<tr>
<th>Syntax</th>
<th>Example</th>
<th>Usage</th>
</tr>
</thead>

<tbody>
<tr>
<td><strong>Script format of function call</strong></td>
<td><pre>sh:<br>  echo &ldquo;I am sh&rdquo;</pre></td>
<td>Calling a Python function with multi-line script as first parameter</td>
</tr>

<tr>
<td><strong>Section header</strong></td>
<td><pre>[step_10]</pre></td>
<td>Define workflow steps</td>
</tr>

<tr>
<td><strong>Parameter definition</strong></td>
<td><pre>parameter: cutoff=5</pre></td>
<td>Define command line argument</td>
</tr>

<tr>
<td><strong>Step input</strong>, output, and depends</td>
<td><pre>input: &ldquo;a.txt&rdquo;</pre></td>
<td>Define input, output, and dependent targets of steps</td>
</tr>

<tr>
<td><strong>Task</strong></td>
<td><pre>task: walltime=&lsquo;24h&rsquo;</pre></td>
<td>Define external tasks</td>
</tr>
</tbody>
</table>

<p></div></p>

<p>As shown in the following figure, a SoS workflow can be created as verbatim inclusion of
scripts in different languages. The script can be annotated with additional workflow
syntax to make use of more and more workflow features such as runtime signature and
external execution of tasks, but the workflow remains readable because the key parts
of the workflow, namely the included scripts, remain largely untouched.</p>

<p><img src="https://vatlab.github.io/sos-docs/doc/media/sos_syntax.gif" alt="SoS notebook with SoS" /></p>

<p>The following videos describes these steps in detail:</p>

<table style="border:0px">
<tr>
<td style="border:0px"><iframe width="373" height="210" src="https://www.youtube.com/embed/E5Eh7BVbbTM" frameborder="0" gesture="media" allow="encrypted-media" allowfullscreen></iframe>
</td>
<td style="border:0px"><iframe width="373" height="210" src="https://www.youtube.com/embed/roTDvSXSPgU" frameborder="0" gesture="media" allow="encrypted-media" allowfullscreen></iframe></td>
</tr>
</table>

<h2 id="benefits-of-using-sos-for-daily-computational-research">Benefits of using SoS for daily computational research</h2>

<p>The moment you convert a script to a SoS workflow step, you have a working SoS workflow
that can benefit from many of SoS&rsquo; execution features.</p>

<h3 id="runtime-signature">Runtime signature</h3>

<p>SoS keeps track of runtime signatures so it will ignore a step if it has been executed
before. The signatures consist of input, output, dependent targets, statements and their
environments (e.g. used global variables) and a step would be re-executed if any of these
items has changed. The signatures are independent of step names and workflows so a step
would be ignored even if it belongs to multiple workflows.</p>

<p>What this means is that you can continuously revise and execute a workflow without
wasting time on the execution of steps that have been executed before, and without
worrying about the re-execution of steps that should be re-executed because of changed
input or parameters.</p>

<p><img src="https://vatlab.github.io/sos-docs/doc/media/signature.gif" alt="SoS notebook with SoS" /></p>

<h3 id="remote-execution">Remote execution</h3>

<p>SoS allows the creation of  <strong>tasks</strong> from part of a workflow step. The tasks
are execution units that are independent of workflows and even file systems so they
can be executed locally or remotely in parallel (subject to number of concurrent running
tasks). With properly configured remote hosts, the same tasks could be executed locally
or on a remote host as separate processes, or be submitted to a PBS (Moab/torque, Slurm,
IBM LSF) system, or task queue systems such as <a href="http://python-rq.org/" target="_blank">RQ</a>. The
remote system does not have to share the same file system as the local host because
SoS automatically synchronizes input files, updates scripts, submits and monitors jobs,
and collects results. It even provides a job monitor system that is independent of
the underlying job systems.</p>

<p>The remote execution feature gives users easy access to all available computing
resources. It frees users from writing platform-specific codes for the submission
and monitoring of jobs and to synchronize input and result files across systems.
It also helps the readability and reproducibility of analysis because both local
and remote scripts are kept in the same notebook, without platform-specific job
management code.</p>

<p><img src="https://vatlab.github.io/sos-docs/doc/media/task.gif" alt="SoS notebook with SoS" /></p>

<h3 id="powerful-workflow-systems">Powerful workflow systems</h3>

<p>SoS supports both forward-style procedure-oriented and
makefile-style outcome-oriented workflows. The forward-style workflows are specified
as numerically ordered steps that will be executed sequentially (logically speaking),
and makefile-style workflows are specified as steps that provides targets that are
used by others. SoS also supports mixed style workflows (forward-style workflow
with dependencies satisfied by makefile-style steps) and nested workflows (execution
of subworkflows as function calls) which allows the creation of very complex
workflows that consists of hundreds of steps. The following figure illustrates the
DAG of a RNA Seq data analysis workflow.</p>

<p><img src="https://vatlab.github.io/sos-docs/doc/media/sample_dag.svg" alt="SoS notebook with SoS" /></p>

<h3 id="readable-workflows-that-are-easy-to-report-share-and-reproduce">Readable workflows that are easy to report, share and reproduce</h3>

<p>SoS Notebook provides <strong>an ideal format for the distribution of SoS workflows and the
reporting and sharing of bioinformatic data analysis</strong> because a SoS notebook can
include all details of a data analytic workflow, including
descriptions of data and analytic steps (in rich text format with tables and figures),
scripts in multiple languages, workflows, and outputs of analysis. The all-in-one nature
of the notebook format also makes it easy to reproduce prior analyses if needed.</p>

<p>The following is an example workflow with steps in Python, R, and bash. It looks
just like other online tutorials you have seen but <a href="https://vatlab.github.io/sos-docs/doc/examples/RNASeqGTEx.ipynb" target="_blank">its notebook version</a>
contains a complete workflow and is readily applicable to your data. The readability
of SoS workflows distinguishes SoS from other workflow systems and makes it a great
tool for the sharing of data processing expertise among bioinformaticians.</p>

<iframe src="https://vatlab.github.io/sos-docs/doc/examples/RNASeqGTEx.html" width="90%" height="300px"></iframe>

<h2 id="summary">Summary</h2>

<p>In summary, SoS provides an environment for both interactive data analysis and batch
data crunching. It has a smooth learning curve because it is based on a widely used
scripting language (Python) with few additional syntaxes. It cures pipelineitis by
providing an easy transition from interactive to batch data analysis so users can
enjoy features such as runtime signature and remote execution with minimal effort.
At the same time, SoS provides a powerful workflow engine for the creation of complex
workflows so whereas you can complete most of your projects use SoS Notebook
and simple workflow features, your analysis can grow as your project grows, all without
leaving your familiar SoS environment.</p>

<p><small>
More details of SoS and SoS Notebook can be found at the <a href="https://vatlab.github.io/sos-docs/" target="_blank">SoS website</a> where you can
find tons of documentations, tutorials, examples, and youtube videos. Please test SoS Notebook and send
your feedback and/or bug reports to our <a href="https://github.com/vatlab/sos-notebook/issues" target="_blank">github issue tracker</a>.
If you find SoS Notebook useful, please support the project by starring the <a href="https://github.com/vatlab/SoS" target="_blank">SoS</a> and
<a href="https://github.com/vatlab/sos-notebook" target="_blank">SoS Notebook</a>
github projects, or spreading the word with <a href="https://twitter.com/ScriptOfScripts" target="_blank">twitter</a>. </small></p>

    </div>
    
  </div>
</section>



<section class="section">
  <div class="container">
<div id="gh-comments">
    <br/><br/>
    <h5>COMMENTS</h5>
    <div id="gh-comments-list"></div>
    <a href="javascript:void(0)" id="gh-load-comments" class="btn" style="display:none">Load more comments</a>
</div>

<script type="text/javascript" src="https://vatlab.github.io/blog/js/github-comments.js"></script>
<script type="text/javascript">
    DoGithubComments( 8 );
</script>
      
  </div>
</section>


<section class="section">
  <div class="container has-text-centered">
    <p>&copy; <a href="https://faculty.mdanderson.org/profiles/bo_peng.html">Bo Peng, Ph.D. / MD Anderson Cancer Center</a> All rights reserved</p>
    
  </div>
</section>


<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-107286198-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>


</body>
<script>

$(document).ready(function(){
    $(".toggle-detail").click(function(e){
        e.preventDefault();
        $('.'+$(this).attr('data-detail')).addClass('text-info').toggle();
    });
});

</script>
</html>
